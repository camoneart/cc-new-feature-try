# --tools フラグ（インタラクティブモード ツール制限）試行メモ

## 対象バージョン

Claude Code 2.1.0

## 概要

`--tools` フラグにより、インタラクティブセッション中に Claude が使用できる組み込みツールを制限できる。

## 試行結果

### 1. 読み取り専用セッション（`claude --tools Read,Grep,Glob`）

- Read, Grep, Glob のみが利用可能な状態で起動された
- Write, Edit, Bash, Agent（サブエージェント）は利用不可
- ファイルの作成・編集・シェルコマンドの実行が一切できないことを確認
- Skill ツールも利用不可

### 2. 制限されたツールでの操作不可確認

- ファイル編集を依頼 → 「Write/Edit ツールがないため不可」と正しく拒否
- PR 作成を依頼 → 「Bash ツールがないため不可」と正しく拒否
- 制限は意図通りに機能している

### 3. 全ツール有効セッションとの比較

| コマンド | 効果 |
|---------|------|
| `claude` | 全ツール有効（デフォルト） |
| `claude --tools Read,Grep,Glob` | 指定したツールのみ有効 |
| `claude --tools Read,Write,Edit,Grep,Glob,Bash` | 明示的に全指定（デフォルトとほぼ同等） |

- `--tools` フラグを省略すると全ツールが有効になるため、全ツール有効にしたい場合はフラグ不要
- `claude -c` で再開すると、`--tools` 制限なしで会話コンテキストを引き継げる

### 4. 実用的なツールセットの検討

| ユースケース | 推奨ツールセット |
|-------------|-----------------|
| コードレビュー専用 | `Read,Grep,Glob` |
| 調査・分析 | `Read,Grep,Glob,Bash` |
| 通常の開発 | フラグ省略（全ツール有効） |
| CI/CD 自動レビュー | `Read,Grep,Glob`（非対話: `claude -p` との組み合わせ） |

## 重要な発見

### MCP ツールは `--tools` の制限対象外

`--tools` フラグは**組み込みツール**のみを制限する。MCP サーバーのツール（Brave Search, Firecrawl, Context7 など）は `--tools` 指定に関係なく引き続き利用可能。

これは「読み取り専用」がローカルファイルシステムに対する制限であり、外部サービス連携は制限されないことを意味する。

### `settings.json` の `disallowedTools` との違い

| 項目 | `--tools` フラグ | `disallowedTools` |
|------|-----------------|-------------------|
| スコープ | セッション単位 | プロジェクト/ユーザー単位（永続） |
| 方式 | ホワイトリスト（指定したものだけ有効） | ブラックリスト（指定したものを無効化） |
| MCP ツール | 制限対象外 | 制限可能 |

### `Task(AgentName)` 構文（2.1.0）

`--tools` とは別に、`Task(AgentName)` 構文で特定のエージェント（サブエージェント）の無効化も可能。

## 所感

- セキュリティの観点で非常に有用。CI/CD で `claude -p` と `--tools Read,Grep,Glob` を組み合わせれば、コードを変更しないことを保証した自動レビューが実現できる
- ワークフロー制御としても便利。「うっかり編集」を防ぎたい場面で安心して使える
- MCP ツールが制限対象外な点は、用途によっては注意が必要
